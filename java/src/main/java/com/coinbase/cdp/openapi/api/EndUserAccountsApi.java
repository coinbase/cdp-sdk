/*
 * Coinbase Developer Platform APIs
 * The Coinbase Developer Platform APIs - leading the world's transition onchain.
 *
 * The version of the OpenAPI document: 2.0.0
 * Contact: cdp@coinbase.com
 *
 * NOTE: This class is auto generated by OpenAPI Generator (https://openapi-generator.tech).
 * https://openapi-generator.tech
 * Do not edit the class manually.
 */

package com.coinbase.cdp.openapi.api;

import com.coinbase.cdp.openapi.ApiClient;
import com.coinbase.cdp.openapi.ApiException;
import com.coinbase.cdp.openapi.ApiResponse;
import com.coinbase.cdp.openapi.Pair;

import com.coinbase.cdp.openapi.model.AddEndUserEvmAccount201Response;
import com.coinbase.cdp.openapi.model.AddEndUserEvmSmartAccount201Response;
import com.coinbase.cdp.openapi.model.AddEndUserEvmSmartAccountRequest;
import com.coinbase.cdp.openapi.model.AddEndUserSolanaAccount201Response;
import com.coinbase.cdp.openapi.model.CreateEndUserRequest;
import com.coinbase.cdp.openapi.model.EndUser;
import com.coinbase.cdp.openapi.model.Error;
import com.coinbase.cdp.openapi.model.ImportEndUserRequest;
import com.coinbase.cdp.openapi.model.ListEndUsers200Response;
import com.coinbase.cdp.openapi.model.ValidateEndUserAccessTokenRequest;

import com.fasterxml.jackson.core.type.TypeReference;
import com.fasterxml.jackson.databind.ObjectMapper;

import java.io.InputStream;
import java.io.ByteArrayInputStream;
import java.io.ByteArrayOutputStream;
import java.io.File;
import java.io.IOException;
import java.io.OutputStream;
import java.net.http.HttpRequest;
import java.nio.channels.Channels;
import java.nio.channels.Pipe;
import java.net.URI;
import java.net.http.HttpClient;
import java.net.http.HttpRequest;
import java.net.http.HttpResponse;
import java.time.Duration;

import java.util.ArrayList;
import java.util.StringJoiner;
import java.util.List;
import java.util.Map;
import java.util.Set;
import java.util.function.Consumer;

@jakarta.annotation.Generated(value = "org.openapitools.codegen.languages.JavaClientCodegen", comments = "Generator version: 7.11.0")
public class EndUserAccountsApi {
  private final HttpClient memberVarHttpClient;
  private final ObjectMapper memberVarObjectMapper;
  private final String memberVarBaseUri;
  private final Consumer<HttpRequest.Builder> memberVarInterceptor;
  private final Duration memberVarReadTimeout;
  private final Consumer<HttpResponse<InputStream>> memberVarResponseInterceptor;
  private final Consumer<HttpResponse<String>> memberVarAsyncResponseInterceptor;

  public EndUserAccountsApi() {
    this(new ApiClient());
  }

  public EndUserAccountsApi(ApiClient apiClient) {
    memberVarHttpClient = apiClient.getHttpClient();
    memberVarObjectMapper = apiClient.getObjectMapper();
    memberVarBaseUri = apiClient.getBaseUri();
    memberVarInterceptor = apiClient.getRequestInterceptor();
    memberVarReadTimeout = apiClient.getReadTimeout();
    memberVarResponseInterceptor = apiClient.getResponseInterceptor();
    memberVarAsyncResponseInterceptor = apiClient.getAsyncResponseInterceptor();
  }

  protected ApiException getApiException(String operationId, HttpResponse<InputStream> response) throws IOException {
    String body = response.body() == null ? null : new String(response.body().readAllBytes());
    String message = formatExceptionMessage(operationId, response.statusCode(), body);
    return new ApiException(response.statusCode(), message, response.headers(), body);
  }

  private String formatExceptionMessage(String operationId, int statusCode, String body) {
    if (body == null || body.isEmpty()) {
      body = "[no body]";
    }
    return operationId + " call failed with: " + statusCode + " - " + body;
  }

  /**
   * Add an EVM account to an end user
   * Adds a new EVM EOA account to an existing end user. End users can have up to 10 EVM accounts. This API is intended to be used by the developer&#39;s own backend, and is authenticated using the developer&#39;s CDP API key.
   * @param userId The ID of the end user to add the account to. (required)
   * @param xWalletAuth A JWT signed using your Wallet Secret, encoded in base64. Refer to the [Generate Wallet Token](https://docs.cdp.coinbase.com/api-reference/v2/authentication#2-generate-wallet-token) section of our Authentication docs for more details on how to generate your Wallet Token.  (optional)
   * @param xIdempotencyKey An optional [UUID v4](https://www.uuidgenerator.net/version4) request header for making requests safely retryable. When included, duplicate requests with the same key will return identical responses.  Refer to our [Idempotency docs](https://docs.cdp.coinbase.com/api-reference/v2/idempotency) for more information on using idempotency keys.  (optional)
   * @param body  (optional)
   * @return AddEndUserEvmAccount201Response
   * @throws ApiException if fails to make API call
   */
  public AddEndUserEvmAccount201Response addEndUserEvmAccount(String userId, String xWalletAuth, String xIdempotencyKey, Object body) throws ApiException {
    ApiResponse<AddEndUserEvmAccount201Response> localVarResponse = addEndUserEvmAccountWithHttpInfo(userId, xWalletAuth, xIdempotencyKey, body);
    return localVarResponse.getData();
  }

  /**
   * Add an EVM account to an end user
   * Adds a new EVM EOA account to an existing end user. End users can have up to 10 EVM accounts. This API is intended to be used by the developer&#39;s own backend, and is authenticated using the developer&#39;s CDP API key.
   * @param userId The ID of the end user to add the account to. (required)
   * @param xWalletAuth A JWT signed using your Wallet Secret, encoded in base64. Refer to the [Generate Wallet Token](https://docs.cdp.coinbase.com/api-reference/v2/authentication#2-generate-wallet-token) section of our Authentication docs for more details on how to generate your Wallet Token.  (optional)
   * @param xIdempotencyKey An optional [UUID v4](https://www.uuidgenerator.net/version4) request header for making requests safely retryable. When included, duplicate requests with the same key will return identical responses.  Refer to our [Idempotency docs](https://docs.cdp.coinbase.com/api-reference/v2/idempotency) for more information on using idempotency keys.  (optional)
   * @param body  (optional)
   * @return ApiResponse&lt;AddEndUserEvmAccount201Response&gt;
   * @throws ApiException if fails to make API call
   */
  public ApiResponse<AddEndUserEvmAccount201Response> addEndUserEvmAccountWithHttpInfo(String userId, String xWalletAuth, String xIdempotencyKey, Object body) throws ApiException {
    HttpRequest.Builder localVarRequestBuilder = addEndUserEvmAccountRequestBuilder(userId, xWalletAuth, xIdempotencyKey, body);
    try {
      HttpResponse<InputStream> localVarResponse = memberVarHttpClient.send(
          localVarRequestBuilder.build(),
          HttpResponse.BodyHandlers.ofInputStream());
      if (memberVarResponseInterceptor != null) {
        memberVarResponseInterceptor.accept(localVarResponse);
      }
      try {
        if (localVarResponse.statusCode()/ 100 != 2) {
          throw getApiException("addEndUserEvmAccount", localVarResponse);
        }
        if (localVarResponse.body() == null) {
          return new ApiResponse<AddEndUserEvmAccount201Response>(
              localVarResponse.statusCode(),
              localVarResponse.headers().map(),
              null
          );
        }

        String responseBody = new String(localVarResponse.body().readAllBytes());
        localVarResponse.body().close();

        return new ApiResponse<AddEndUserEvmAccount201Response>(
            localVarResponse.statusCode(),
            localVarResponse.headers().map(),
            responseBody.isBlank()? null: memberVarObjectMapper.readValue(responseBody, new TypeReference<AddEndUserEvmAccount201Response>() {})
        );
      } finally {
      }
    } catch (IOException e) {
      throw new ApiException(e);
    }
    catch (InterruptedException e) {
      Thread.currentThread().interrupt();
      throw new ApiException(e);
    }
  }

  private HttpRequest.Builder addEndUserEvmAccountRequestBuilder(String userId, String xWalletAuth, String xIdempotencyKey, Object body) throws ApiException {
    // verify the required parameter 'userId' is set
    if (userId == null) {
      throw new ApiException(400, "Missing the required parameter 'userId' when calling addEndUserEvmAccount");
    }

    HttpRequest.Builder localVarRequestBuilder = HttpRequest.newBuilder();

    String localVarPath = "/v2/end-users/{userId}/evm"
        .replace("{userId}", ApiClient.urlEncode(userId.toString()));

    localVarRequestBuilder.uri(URI.create(memberVarBaseUri + localVarPath));

    if (xWalletAuth != null) {
      localVarRequestBuilder.header("X-Wallet-Auth", xWalletAuth.toString());
    }
    if (xIdempotencyKey != null) {
      localVarRequestBuilder.header("X-Idempotency-Key", xIdempotencyKey.toString());
    }
    localVarRequestBuilder.header("Content-Type", "application/json");
    localVarRequestBuilder.header("Accept", "application/json");

    try {
      byte[] localVarPostBody = memberVarObjectMapper.writeValueAsBytes(body);
      localVarRequestBuilder.method("POST", HttpRequest.BodyPublishers.ofByteArray(localVarPostBody));
    } catch (IOException e) {
      throw new ApiException(e);
    }
    if (memberVarReadTimeout != null) {
      localVarRequestBuilder.timeout(memberVarReadTimeout);
    }
    if (memberVarInterceptor != null) {
      memberVarInterceptor.accept(localVarRequestBuilder);
    }
    return localVarRequestBuilder;
  }

  /**
   * Add an EVM smart account to an end user
   * Creates an EVM smart account for an existing end user. The backend will create a new EVM EOA account to serve as the owner of the smart account. This API is intended to be used by the developer&#39;s own backend, and is authenticated using the developer&#39;s CDP API key.
   * @param userId The ID of the end user to add the smart account to. (required)
   * @param xWalletAuth A JWT signed using your Wallet Secret, encoded in base64. Refer to the [Generate Wallet Token](https://docs.cdp.coinbase.com/api-reference/v2/authentication#2-generate-wallet-token) section of our Authentication docs for more details on how to generate your Wallet Token.  (optional)
   * @param xIdempotencyKey An optional [UUID v4](https://www.uuidgenerator.net/version4) request header for making requests safely retryable. When included, duplicate requests with the same key will return identical responses.  Refer to our [Idempotency docs](https://docs.cdp.coinbase.com/api-reference/v2/idempotency) for more information on using idempotency keys.  (optional)
   * @param addEndUserEvmSmartAccountRequest  (optional)
   * @return AddEndUserEvmSmartAccount201Response
   * @throws ApiException if fails to make API call
   */
  public AddEndUserEvmSmartAccount201Response addEndUserEvmSmartAccount(String userId, String xWalletAuth, String xIdempotencyKey, AddEndUserEvmSmartAccountRequest addEndUserEvmSmartAccountRequest) throws ApiException {
    ApiResponse<AddEndUserEvmSmartAccount201Response> localVarResponse = addEndUserEvmSmartAccountWithHttpInfo(userId, xWalletAuth, xIdempotencyKey, addEndUserEvmSmartAccountRequest);
    return localVarResponse.getData();
  }

  /**
   * Add an EVM smart account to an end user
   * Creates an EVM smart account for an existing end user. The backend will create a new EVM EOA account to serve as the owner of the smart account. This API is intended to be used by the developer&#39;s own backend, and is authenticated using the developer&#39;s CDP API key.
   * @param userId The ID of the end user to add the smart account to. (required)
   * @param xWalletAuth A JWT signed using your Wallet Secret, encoded in base64. Refer to the [Generate Wallet Token](https://docs.cdp.coinbase.com/api-reference/v2/authentication#2-generate-wallet-token) section of our Authentication docs for more details on how to generate your Wallet Token.  (optional)
   * @param xIdempotencyKey An optional [UUID v4](https://www.uuidgenerator.net/version4) request header for making requests safely retryable. When included, duplicate requests with the same key will return identical responses.  Refer to our [Idempotency docs](https://docs.cdp.coinbase.com/api-reference/v2/idempotency) for more information on using idempotency keys.  (optional)
   * @param addEndUserEvmSmartAccountRequest  (optional)
   * @return ApiResponse&lt;AddEndUserEvmSmartAccount201Response&gt;
   * @throws ApiException if fails to make API call
   */
  public ApiResponse<AddEndUserEvmSmartAccount201Response> addEndUserEvmSmartAccountWithHttpInfo(String userId, String xWalletAuth, String xIdempotencyKey, AddEndUserEvmSmartAccountRequest addEndUserEvmSmartAccountRequest) throws ApiException {
    HttpRequest.Builder localVarRequestBuilder = addEndUserEvmSmartAccountRequestBuilder(userId, xWalletAuth, xIdempotencyKey, addEndUserEvmSmartAccountRequest);
    try {
      HttpResponse<InputStream> localVarResponse = memberVarHttpClient.send(
          localVarRequestBuilder.build(),
          HttpResponse.BodyHandlers.ofInputStream());
      if (memberVarResponseInterceptor != null) {
        memberVarResponseInterceptor.accept(localVarResponse);
      }
      try {
        if (localVarResponse.statusCode()/ 100 != 2) {
          throw getApiException("addEndUserEvmSmartAccount", localVarResponse);
        }
        if (localVarResponse.body() == null) {
          return new ApiResponse<AddEndUserEvmSmartAccount201Response>(
              localVarResponse.statusCode(),
              localVarResponse.headers().map(),
              null
          );
        }

        String responseBody = new String(localVarResponse.body().readAllBytes());
        localVarResponse.body().close();

        return new ApiResponse<AddEndUserEvmSmartAccount201Response>(
            localVarResponse.statusCode(),
            localVarResponse.headers().map(),
            responseBody.isBlank()? null: memberVarObjectMapper.readValue(responseBody, new TypeReference<AddEndUserEvmSmartAccount201Response>() {})
        );
      } finally {
      }
    } catch (IOException e) {
      throw new ApiException(e);
    }
    catch (InterruptedException e) {
      Thread.currentThread().interrupt();
      throw new ApiException(e);
    }
  }

  private HttpRequest.Builder addEndUserEvmSmartAccountRequestBuilder(String userId, String xWalletAuth, String xIdempotencyKey, AddEndUserEvmSmartAccountRequest addEndUserEvmSmartAccountRequest) throws ApiException {
    // verify the required parameter 'userId' is set
    if (userId == null) {
      throw new ApiException(400, "Missing the required parameter 'userId' when calling addEndUserEvmSmartAccount");
    }

    HttpRequest.Builder localVarRequestBuilder = HttpRequest.newBuilder();

    String localVarPath = "/v2/end-users/{userId}/evm-smart-account"
        .replace("{userId}", ApiClient.urlEncode(userId.toString()));

    localVarRequestBuilder.uri(URI.create(memberVarBaseUri + localVarPath));

    if (xWalletAuth != null) {
      localVarRequestBuilder.header("X-Wallet-Auth", xWalletAuth.toString());
    }
    if (xIdempotencyKey != null) {
      localVarRequestBuilder.header("X-Idempotency-Key", xIdempotencyKey.toString());
    }
    localVarRequestBuilder.header("Content-Type", "application/json");
    localVarRequestBuilder.header("Accept", "application/json");

    try {
      byte[] localVarPostBody = memberVarObjectMapper.writeValueAsBytes(addEndUserEvmSmartAccountRequest);
      localVarRequestBuilder.method("POST", HttpRequest.BodyPublishers.ofByteArray(localVarPostBody));
    } catch (IOException e) {
      throw new ApiException(e);
    }
    if (memberVarReadTimeout != null) {
      localVarRequestBuilder.timeout(memberVarReadTimeout);
    }
    if (memberVarInterceptor != null) {
      memberVarInterceptor.accept(localVarRequestBuilder);
    }
    return localVarRequestBuilder;
  }

  /**
   * Add a Solana account to an end user
   * Adds a new Solana account to an existing end user. End users can have  up to 10 Solana accounts. This API is intended to be used by the developer&#39;s own backend, and is authenticated using the developer&#39;s CDP API key.
   * @param userId The ID of the end user to add the account to. (required)
   * @param xWalletAuth A JWT signed using your Wallet Secret, encoded in base64. Refer to the [Generate Wallet Token](https://docs.cdp.coinbase.com/api-reference/v2/authentication#2-generate-wallet-token) section of our Authentication docs for more details on how to generate your Wallet Token.  (optional)
   * @param xIdempotencyKey An optional [UUID v4](https://www.uuidgenerator.net/version4) request header for making requests safely retryable. When included, duplicate requests with the same key will return identical responses.  Refer to our [Idempotency docs](https://docs.cdp.coinbase.com/api-reference/v2/idempotency) for more information on using idempotency keys.  (optional)
   * @param body  (optional)
   * @return AddEndUserSolanaAccount201Response
   * @throws ApiException if fails to make API call
   */
  public AddEndUserSolanaAccount201Response addEndUserSolanaAccount(String userId, String xWalletAuth, String xIdempotencyKey, Object body) throws ApiException {
    ApiResponse<AddEndUserSolanaAccount201Response> localVarResponse = addEndUserSolanaAccountWithHttpInfo(userId, xWalletAuth, xIdempotencyKey, body);
    return localVarResponse.getData();
  }

  /**
   * Add a Solana account to an end user
   * Adds a new Solana account to an existing end user. End users can have  up to 10 Solana accounts. This API is intended to be used by the developer&#39;s own backend, and is authenticated using the developer&#39;s CDP API key.
   * @param userId The ID of the end user to add the account to. (required)
   * @param xWalletAuth A JWT signed using your Wallet Secret, encoded in base64. Refer to the [Generate Wallet Token](https://docs.cdp.coinbase.com/api-reference/v2/authentication#2-generate-wallet-token) section of our Authentication docs for more details on how to generate your Wallet Token.  (optional)
   * @param xIdempotencyKey An optional [UUID v4](https://www.uuidgenerator.net/version4) request header for making requests safely retryable. When included, duplicate requests with the same key will return identical responses.  Refer to our [Idempotency docs](https://docs.cdp.coinbase.com/api-reference/v2/idempotency) for more information on using idempotency keys.  (optional)
   * @param body  (optional)
   * @return ApiResponse&lt;AddEndUserSolanaAccount201Response&gt;
   * @throws ApiException if fails to make API call
   */
  public ApiResponse<AddEndUserSolanaAccount201Response> addEndUserSolanaAccountWithHttpInfo(String userId, String xWalletAuth, String xIdempotencyKey, Object body) throws ApiException {
    HttpRequest.Builder localVarRequestBuilder = addEndUserSolanaAccountRequestBuilder(userId, xWalletAuth, xIdempotencyKey, body);
    try {
      HttpResponse<InputStream> localVarResponse = memberVarHttpClient.send(
          localVarRequestBuilder.build(),
          HttpResponse.BodyHandlers.ofInputStream());
      if (memberVarResponseInterceptor != null) {
        memberVarResponseInterceptor.accept(localVarResponse);
      }
      try {
        if (localVarResponse.statusCode()/ 100 != 2) {
          throw getApiException("addEndUserSolanaAccount", localVarResponse);
        }
        if (localVarResponse.body() == null) {
          return new ApiResponse<AddEndUserSolanaAccount201Response>(
              localVarResponse.statusCode(),
              localVarResponse.headers().map(),
              null
          );
        }

        String responseBody = new String(localVarResponse.body().readAllBytes());
        localVarResponse.body().close();

        return new ApiResponse<AddEndUserSolanaAccount201Response>(
            localVarResponse.statusCode(),
            localVarResponse.headers().map(),
            responseBody.isBlank()? null: memberVarObjectMapper.readValue(responseBody, new TypeReference<AddEndUserSolanaAccount201Response>() {})
        );
      } finally {
      }
    } catch (IOException e) {
      throw new ApiException(e);
    }
    catch (InterruptedException e) {
      Thread.currentThread().interrupt();
      throw new ApiException(e);
    }
  }

  private HttpRequest.Builder addEndUserSolanaAccountRequestBuilder(String userId, String xWalletAuth, String xIdempotencyKey, Object body) throws ApiException {
    // verify the required parameter 'userId' is set
    if (userId == null) {
      throw new ApiException(400, "Missing the required parameter 'userId' when calling addEndUserSolanaAccount");
    }

    HttpRequest.Builder localVarRequestBuilder = HttpRequest.newBuilder();

    String localVarPath = "/v2/end-users/{userId}/solana"
        .replace("{userId}", ApiClient.urlEncode(userId.toString()));

    localVarRequestBuilder.uri(URI.create(memberVarBaseUri + localVarPath));

    if (xWalletAuth != null) {
      localVarRequestBuilder.header("X-Wallet-Auth", xWalletAuth.toString());
    }
    if (xIdempotencyKey != null) {
      localVarRequestBuilder.header("X-Idempotency-Key", xIdempotencyKey.toString());
    }
    localVarRequestBuilder.header("Content-Type", "application/json");
    localVarRequestBuilder.header("Accept", "application/json");

    try {
      byte[] localVarPostBody = memberVarObjectMapper.writeValueAsBytes(body);
      localVarRequestBuilder.method("POST", HttpRequest.BodyPublishers.ofByteArray(localVarPostBody));
    } catch (IOException e) {
      throw new ApiException(e);
    }
    if (memberVarReadTimeout != null) {
      localVarRequestBuilder.timeout(memberVarReadTimeout);
    }
    if (memberVarInterceptor != null) {
      memberVarInterceptor.accept(localVarRequestBuilder);
    }
    return localVarRequestBuilder;
  }

  /**
   * Create an end user
   * Creates an end user. An end user is an entity that can own CDP EVM accounts, EVM smart accounts, and/or Solana accounts. 1 or more authentication methods must be associated with an end user. By default, no accounts are created unless the optional &#x60;evmAccount&#x60; and/or &#x60;solanaAccount&#x60; fields are provided. This API is intended to be used by the developer&#39;s own backend, and is authenticated using the developer&#39;s CDP API key.
   * @param xWalletAuth A JWT signed using your Wallet Secret, encoded in base64. Refer to the [Generate Wallet Token](https://docs.cdp.coinbase.com/api-reference/v2/authentication#2-generate-wallet-token) section of our Authentication docs for more details on how to generate your Wallet Token.  (optional)
   * @param xIdempotencyKey An optional [UUID v4](https://www.uuidgenerator.net/version4) request header for making requests safely retryable. When included, duplicate requests with the same key will return identical responses.  Refer to our [Idempotency docs](https://docs.cdp.coinbase.com/api-reference/v2/idempotency) for more information on using idempotency keys.  (optional)
   * @param createEndUserRequest  (optional)
   * @return EndUser
   * @throws ApiException if fails to make API call
   */
  public EndUser createEndUser(String xWalletAuth, String xIdempotencyKey, CreateEndUserRequest createEndUserRequest) throws ApiException {
    ApiResponse<EndUser> localVarResponse = createEndUserWithHttpInfo(xWalletAuth, xIdempotencyKey, createEndUserRequest);
    return localVarResponse.getData();
  }

  /**
   * Create an end user
   * Creates an end user. An end user is an entity that can own CDP EVM accounts, EVM smart accounts, and/or Solana accounts. 1 or more authentication methods must be associated with an end user. By default, no accounts are created unless the optional &#x60;evmAccount&#x60; and/or &#x60;solanaAccount&#x60; fields are provided. This API is intended to be used by the developer&#39;s own backend, and is authenticated using the developer&#39;s CDP API key.
   * @param xWalletAuth A JWT signed using your Wallet Secret, encoded in base64. Refer to the [Generate Wallet Token](https://docs.cdp.coinbase.com/api-reference/v2/authentication#2-generate-wallet-token) section of our Authentication docs for more details on how to generate your Wallet Token.  (optional)
   * @param xIdempotencyKey An optional [UUID v4](https://www.uuidgenerator.net/version4) request header for making requests safely retryable. When included, duplicate requests with the same key will return identical responses.  Refer to our [Idempotency docs](https://docs.cdp.coinbase.com/api-reference/v2/idempotency) for more information on using idempotency keys.  (optional)
   * @param createEndUserRequest  (optional)
   * @return ApiResponse&lt;EndUser&gt;
   * @throws ApiException if fails to make API call
   */
  public ApiResponse<EndUser> createEndUserWithHttpInfo(String xWalletAuth, String xIdempotencyKey, CreateEndUserRequest createEndUserRequest) throws ApiException {
    HttpRequest.Builder localVarRequestBuilder = createEndUserRequestBuilder(xWalletAuth, xIdempotencyKey, createEndUserRequest);
    try {
      HttpResponse<InputStream> localVarResponse = memberVarHttpClient.send(
          localVarRequestBuilder.build(),
          HttpResponse.BodyHandlers.ofInputStream());
      if (memberVarResponseInterceptor != null) {
        memberVarResponseInterceptor.accept(localVarResponse);
      }
      try {
        if (localVarResponse.statusCode()/ 100 != 2) {
          throw getApiException("createEndUser", localVarResponse);
        }
        if (localVarResponse.body() == null) {
          return new ApiResponse<EndUser>(
              localVarResponse.statusCode(),
              localVarResponse.headers().map(),
              null
          );
        }

        String responseBody = new String(localVarResponse.body().readAllBytes());
        localVarResponse.body().close();

        return new ApiResponse<EndUser>(
            localVarResponse.statusCode(),
            localVarResponse.headers().map(),
            responseBody.isBlank()? null: memberVarObjectMapper.readValue(responseBody, new TypeReference<EndUser>() {})
        );
      } finally {
      }
    } catch (IOException e) {
      throw new ApiException(e);
    }
    catch (InterruptedException e) {
      Thread.currentThread().interrupt();
      throw new ApiException(e);
    }
  }

  private HttpRequest.Builder createEndUserRequestBuilder(String xWalletAuth, String xIdempotencyKey, CreateEndUserRequest createEndUserRequest) throws ApiException {

    HttpRequest.Builder localVarRequestBuilder = HttpRequest.newBuilder();

    String localVarPath = "/v2/end-users";

    localVarRequestBuilder.uri(URI.create(memberVarBaseUri + localVarPath));

    if (xWalletAuth != null) {
      localVarRequestBuilder.header("X-Wallet-Auth", xWalletAuth.toString());
    }
    if (xIdempotencyKey != null) {
      localVarRequestBuilder.header("X-Idempotency-Key", xIdempotencyKey.toString());
    }
    localVarRequestBuilder.header("Content-Type", "application/json");
    localVarRequestBuilder.header("Accept", "application/json");

    try {
      byte[] localVarPostBody = memberVarObjectMapper.writeValueAsBytes(createEndUserRequest);
      localVarRequestBuilder.method("POST", HttpRequest.BodyPublishers.ofByteArray(localVarPostBody));
    } catch (IOException e) {
      throw new ApiException(e);
    }
    if (memberVarReadTimeout != null) {
      localVarRequestBuilder.timeout(memberVarReadTimeout);
    }
    if (memberVarInterceptor != null) {
      memberVarInterceptor.accept(localVarRequestBuilder);
    }
    return localVarRequestBuilder;
  }

  /**
   * Get an end user
   * Gets an end user by ID.  This API is intended to be used by the developer&#39;s own backend, and is authenticated using the developer&#39;s CDP API key.
   * @param userId The ID of the end user to get. (required)
   * @return EndUser
   * @throws ApiException if fails to make API call
   */
  public EndUser getEndUser(String userId) throws ApiException {
    ApiResponse<EndUser> localVarResponse = getEndUserWithHttpInfo(userId);
    return localVarResponse.getData();
  }

  /**
   * Get an end user
   * Gets an end user by ID.  This API is intended to be used by the developer&#39;s own backend, and is authenticated using the developer&#39;s CDP API key.
   * @param userId The ID of the end user to get. (required)
   * @return ApiResponse&lt;EndUser&gt;
   * @throws ApiException if fails to make API call
   */
  public ApiResponse<EndUser> getEndUserWithHttpInfo(String userId) throws ApiException {
    HttpRequest.Builder localVarRequestBuilder = getEndUserRequestBuilder(userId);
    try {
      HttpResponse<InputStream> localVarResponse = memberVarHttpClient.send(
          localVarRequestBuilder.build(),
          HttpResponse.BodyHandlers.ofInputStream());
      if (memberVarResponseInterceptor != null) {
        memberVarResponseInterceptor.accept(localVarResponse);
      }
      try {
        if (localVarResponse.statusCode()/ 100 != 2) {
          throw getApiException("getEndUser", localVarResponse);
        }
        if (localVarResponse.body() == null) {
          return new ApiResponse<EndUser>(
              localVarResponse.statusCode(),
              localVarResponse.headers().map(),
              null
          );
        }

        String responseBody = new String(localVarResponse.body().readAllBytes());
        localVarResponse.body().close();

        return new ApiResponse<EndUser>(
            localVarResponse.statusCode(),
            localVarResponse.headers().map(),
            responseBody.isBlank()? null: memberVarObjectMapper.readValue(responseBody, new TypeReference<EndUser>() {})
        );
      } finally {
      }
    } catch (IOException e) {
      throw new ApiException(e);
    }
    catch (InterruptedException e) {
      Thread.currentThread().interrupt();
      throw new ApiException(e);
    }
  }

  private HttpRequest.Builder getEndUserRequestBuilder(String userId) throws ApiException {
    // verify the required parameter 'userId' is set
    if (userId == null) {
      throw new ApiException(400, "Missing the required parameter 'userId' when calling getEndUser");
    }

    HttpRequest.Builder localVarRequestBuilder = HttpRequest.newBuilder();

    String localVarPath = "/v2/end-users/{userId}"
        .replace("{userId}", ApiClient.urlEncode(userId.toString()));

    localVarRequestBuilder.uri(URI.create(memberVarBaseUri + localVarPath));

    localVarRequestBuilder.header("Accept", "application/json");

    localVarRequestBuilder.method("GET", HttpRequest.BodyPublishers.noBody());
    if (memberVarReadTimeout != null) {
      localVarRequestBuilder.timeout(memberVarReadTimeout);
    }
    if (memberVarInterceptor != null) {
      memberVarInterceptor.accept(localVarRequestBuilder);
    }
    return localVarRequestBuilder;
  }

  /**
   * Import a private key for an end user
   * Imports an existing private key for an end user into the developer&#39;s CDP Project. The private key must be encrypted using the CDP SDK&#39;s encryption scheme before being sent to this endpoint. This API should be called from the [CDP SDK](https://github.com/coinbase/cdp-sdk) to ensure that the associated private key is properly encrypted.  This endpoint allows developers to import existing keys for their end users, supporting both EVM and Solana key types. The end user must have at least one authentication method configured.
   * @param xWalletAuth A JWT signed using your Wallet Secret, encoded in base64. Refer to the [Generate Wallet Token](https://docs.cdp.coinbase.com/api-reference/v2/authentication#2-generate-wallet-token) section of our Authentication docs for more details on how to generate your Wallet Token.  (optional)
   * @param xIdempotencyKey An optional [UUID v4](https://www.uuidgenerator.net/version4) request header for making requests safely retryable. When included, duplicate requests with the same key will return identical responses.  Refer to our [Idempotency docs](https://docs.cdp.coinbase.com/api-reference/v2/idempotency) for more information on using idempotency keys.  (optional)
   * @param importEndUserRequest  (optional)
   * @return EndUser
   * @throws ApiException if fails to make API call
   */
  public EndUser importEndUser(String xWalletAuth, String xIdempotencyKey, ImportEndUserRequest importEndUserRequest) throws ApiException {
    ApiResponse<EndUser> localVarResponse = importEndUserWithHttpInfo(xWalletAuth, xIdempotencyKey, importEndUserRequest);
    return localVarResponse.getData();
  }

  /**
   * Import a private key for an end user
   * Imports an existing private key for an end user into the developer&#39;s CDP Project. The private key must be encrypted using the CDP SDK&#39;s encryption scheme before being sent to this endpoint. This API should be called from the [CDP SDK](https://github.com/coinbase/cdp-sdk) to ensure that the associated private key is properly encrypted.  This endpoint allows developers to import existing keys for their end users, supporting both EVM and Solana key types. The end user must have at least one authentication method configured.
   * @param xWalletAuth A JWT signed using your Wallet Secret, encoded in base64. Refer to the [Generate Wallet Token](https://docs.cdp.coinbase.com/api-reference/v2/authentication#2-generate-wallet-token) section of our Authentication docs for more details on how to generate your Wallet Token.  (optional)
   * @param xIdempotencyKey An optional [UUID v4](https://www.uuidgenerator.net/version4) request header for making requests safely retryable. When included, duplicate requests with the same key will return identical responses.  Refer to our [Idempotency docs](https://docs.cdp.coinbase.com/api-reference/v2/idempotency) for more information on using idempotency keys.  (optional)
   * @param importEndUserRequest  (optional)
   * @return ApiResponse&lt;EndUser&gt;
   * @throws ApiException if fails to make API call
   */
  public ApiResponse<EndUser> importEndUserWithHttpInfo(String xWalletAuth, String xIdempotencyKey, ImportEndUserRequest importEndUserRequest) throws ApiException {
    HttpRequest.Builder localVarRequestBuilder = importEndUserRequestBuilder(xWalletAuth, xIdempotencyKey, importEndUserRequest);
    try {
      HttpResponse<InputStream> localVarResponse = memberVarHttpClient.send(
          localVarRequestBuilder.build(),
          HttpResponse.BodyHandlers.ofInputStream());
      if (memberVarResponseInterceptor != null) {
        memberVarResponseInterceptor.accept(localVarResponse);
      }
      try {
        if (localVarResponse.statusCode()/ 100 != 2) {
          throw getApiException("importEndUser", localVarResponse);
        }
        if (localVarResponse.body() == null) {
          return new ApiResponse<EndUser>(
              localVarResponse.statusCode(),
              localVarResponse.headers().map(),
              null
          );
        }

        String responseBody = new String(localVarResponse.body().readAllBytes());
        localVarResponse.body().close();

        return new ApiResponse<EndUser>(
            localVarResponse.statusCode(),
            localVarResponse.headers().map(),
            responseBody.isBlank()? null: memberVarObjectMapper.readValue(responseBody, new TypeReference<EndUser>() {})
        );
      } finally {
      }
    } catch (IOException e) {
      throw new ApiException(e);
    }
    catch (InterruptedException e) {
      Thread.currentThread().interrupt();
      throw new ApiException(e);
    }
  }

  private HttpRequest.Builder importEndUserRequestBuilder(String xWalletAuth, String xIdempotencyKey, ImportEndUserRequest importEndUserRequest) throws ApiException {

    HttpRequest.Builder localVarRequestBuilder = HttpRequest.newBuilder();

    String localVarPath = "/v2/end-users/import";

    localVarRequestBuilder.uri(URI.create(memberVarBaseUri + localVarPath));

    if (xWalletAuth != null) {
      localVarRequestBuilder.header("X-Wallet-Auth", xWalletAuth.toString());
    }
    if (xIdempotencyKey != null) {
      localVarRequestBuilder.header("X-Idempotency-Key", xIdempotencyKey.toString());
    }
    localVarRequestBuilder.header("Content-Type", "application/json");
    localVarRequestBuilder.header("Accept", "application/json");

    try {
      byte[] localVarPostBody = memberVarObjectMapper.writeValueAsBytes(importEndUserRequest);
      localVarRequestBuilder.method("POST", HttpRequest.BodyPublishers.ofByteArray(localVarPostBody));
    } catch (IOException e) {
      throw new ApiException(e);
    }
    if (memberVarReadTimeout != null) {
      localVarRequestBuilder.timeout(memberVarReadTimeout);
    }
    if (memberVarInterceptor != null) {
      memberVarInterceptor.accept(localVarRequestBuilder);
    }
    return localVarRequestBuilder;
  }

  /**
   * List end users
   * Lists the end users belonging to the developer&#39;s CDP Project. By default, the response is sorted by creation date in ascending order and paginated to 20 users per page.
   * @param pageSize The number of end users to return per page. (optional, default to 20)
   * @param pageToken The token for the desired page of end users. Will be empty if there are no more end users to fetch. (optional)
   * @param sort Sort end users. Defaults to ascending order (oldest first). (optional)
   * @return ListEndUsers200Response
   * @throws ApiException if fails to make API call
   */
  public ListEndUsers200Response listEndUsers(Integer pageSize, String pageToken, List<String> sort) throws ApiException {
    ApiResponse<ListEndUsers200Response> localVarResponse = listEndUsersWithHttpInfo(pageSize, pageToken, sort);
    return localVarResponse.getData();
  }

  /**
   * List end users
   * Lists the end users belonging to the developer&#39;s CDP Project. By default, the response is sorted by creation date in ascending order and paginated to 20 users per page.
   * @param pageSize The number of end users to return per page. (optional, default to 20)
   * @param pageToken The token for the desired page of end users. Will be empty if there are no more end users to fetch. (optional)
   * @param sort Sort end users. Defaults to ascending order (oldest first). (optional)
   * @return ApiResponse&lt;ListEndUsers200Response&gt;
   * @throws ApiException if fails to make API call
   */
  public ApiResponse<ListEndUsers200Response> listEndUsersWithHttpInfo(Integer pageSize, String pageToken, List<String> sort) throws ApiException {
    HttpRequest.Builder localVarRequestBuilder = listEndUsersRequestBuilder(pageSize, pageToken, sort);
    try {
      HttpResponse<InputStream> localVarResponse = memberVarHttpClient.send(
          localVarRequestBuilder.build(),
          HttpResponse.BodyHandlers.ofInputStream());
      if (memberVarResponseInterceptor != null) {
        memberVarResponseInterceptor.accept(localVarResponse);
      }
      try {
        if (localVarResponse.statusCode()/ 100 != 2) {
          throw getApiException("listEndUsers", localVarResponse);
        }
        if (localVarResponse.body() == null) {
          return new ApiResponse<ListEndUsers200Response>(
              localVarResponse.statusCode(),
              localVarResponse.headers().map(),
              null
          );
        }

        String responseBody = new String(localVarResponse.body().readAllBytes());
        localVarResponse.body().close();

        return new ApiResponse<ListEndUsers200Response>(
            localVarResponse.statusCode(),
            localVarResponse.headers().map(),
            responseBody.isBlank()? null: memberVarObjectMapper.readValue(responseBody, new TypeReference<ListEndUsers200Response>() {})
        );
      } finally {
      }
    } catch (IOException e) {
      throw new ApiException(e);
    }
    catch (InterruptedException e) {
      Thread.currentThread().interrupt();
      throw new ApiException(e);
    }
  }

  private HttpRequest.Builder listEndUsersRequestBuilder(Integer pageSize, String pageToken, List<String> sort) throws ApiException {

    HttpRequest.Builder localVarRequestBuilder = HttpRequest.newBuilder();

    String localVarPath = "/v2/end-users";

    List<Pair> localVarQueryParams = new ArrayList<>();
    StringJoiner localVarQueryStringJoiner = new StringJoiner("&");
    String localVarQueryParameterBaseName;
    localVarQueryParameterBaseName = "pageSize";
    localVarQueryParams.addAll(ApiClient.parameterToPairs("pageSize", pageSize));
    localVarQueryParameterBaseName = "pageToken";
    localVarQueryParams.addAll(ApiClient.parameterToPairs("pageToken", pageToken));
    localVarQueryParameterBaseName = "sort";
    localVarQueryParams.addAll(ApiClient.parameterToPairs("csv", "sort", sort));

    if (!localVarQueryParams.isEmpty() || localVarQueryStringJoiner.length() != 0) {
      StringJoiner queryJoiner = new StringJoiner("&");
      localVarQueryParams.forEach(p -> queryJoiner.add(p.getName() + '=' + p.getValue()));
      if (localVarQueryStringJoiner.length() != 0) {
        queryJoiner.add(localVarQueryStringJoiner.toString());
      }
      localVarRequestBuilder.uri(URI.create(memberVarBaseUri + localVarPath + '?' + queryJoiner.toString()));
    } else {
      localVarRequestBuilder.uri(URI.create(memberVarBaseUri + localVarPath));
    }

    localVarRequestBuilder.header("Accept", "application/json");

    localVarRequestBuilder.method("GET", HttpRequest.BodyPublishers.noBody());
    if (memberVarReadTimeout != null) {
      localVarRequestBuilder.timeout(memberVarReadTimeout);
    }
    if (memberVarInterceptor != null) {
      memberVarInterceptor.accept(localVarRequestBuilder);
    }
    return localVarRequestBuilder;
  }

  /**
   * Validate end user access token
   * Validates the end user&#39;s access token and returns the end user&#39;s information. Returns an error if the access token is invalid or expired.  This API is intended to be used by the developer&#39;s own backend, and is authenticated using the developer&#39;s CDP API key.
   * @param validateEndUserAccessTokenRequest  (optional)
   * @return EndUser
   * @throws ApiException if fails to make API call
   */
  public EndUser validateEndUserAccessToken(ValidateEndUserAccessTokenRequest validateEndUserAccessTokenRequest) throws ApiException {
    ApiResponse<EndUser> localVarResponse = validateEndUserAccessTokenWithHttpInfo(validateEndUserAccessTokenRequest);
    return localVarResponse.getData();
  }

  /**
   * Validate end user access token
   * Validates the end user&#39;s access token and returns the end user&#39;s information. Returns an error if the access token is invalid or expired.  This API is intended to be used by the developer&#39;s own backend, and is authenticated using the developer&#39;s CDP API key.
   * @param validateEndUserAccessTokenRequest  (optional)
   * @return ApiResponse&lt;EndUser&gt;
   * @throws ApiException if fails to make API call
   */
  public ApiResponse<EndUser> validateEndUserAccessTokenWithHttpInfo(ValidateEndUserAccessTokenRequest validateEndUserAccessTokenRequest) throws ApiException {
    HttpRequest.Builder localVarRequestBuilder = validateEndUserAccessTokenRequestBuilder(validateEndUserAccessTokenRequest);
    try {
      HttpResponse<InputStream> localVarResponse = memberVarHttpClient.send(
          localVarRequestBuilder.build(),
          HttpResponse.BodyHandlers.ofInputStream());
      if (memberVarResponseInterceptor != null) {
        memberVarResponseInterceptor.accept(localVarResponse);
      }
      try {
        if (localVarResponse.statusCode()/ 100 != 2) {
          throw getApiException("validateEndUserAccessToken", localVarResponse);
        }
        if (localVarResponse.body() == null) {
          return new ApiResponse<EndUser>(
              localVarResponse.statusCode(),
              localVarResponse.headers().map(),
              null
          );
        }

        String responseBody = new String(localVarResponse.body().readAllBytes());
        localVarResponse.body().close();

        return new ApiResponse<EndUser>(
            localVarResponse.statusCode(),
            localVarResponse.headers().map(),
            responseBody.isBlank()? null: memberVarObjectMapper.readValue(responseBody, new TypeReference<EndUser>() {})
        );
      } finally {
      }
    } catch (IOException e) {
      throw new ApiException(e);
    }
    catch (InterruptedException e) {
      Thread.currentThread().interrupt();
      throw new ApiException(e);
    }
  }

  private HttpRequest.Builder validateEndUserAccessTokenRequestBuilder(ValidateEndUserAccessTokenRequest validateEndUserAccessTokenRequest) throws ApiException {

    HttpRequest.Builder localVarRequestBuilder = HttpRequest.newBuilder();

    String localVarPath = "/v2/end-users/auth/validate-token";

    localVarRequestBuilder.uri(URI.create(memberVarBaseUri + localVarPath));

    localVarRequestBuilder.header("Content-Type", "application/json");
    localVarRequestBuilder.header("Accept", "application/json");

    try {
      byte[] localVarPostBody = memberVarObjectMapper.writeValueAsBytes(validateEndUserAccessTokenRequest);
      localVarRequestBuilder.method("POST", HttpRequest.BodyPublishers.ofByteArray(localVarPostBody));
    } catch (IOException e) {
      throw new ApiException(e);
    }
    if (memberVarReadTimeout != null) {
      localVarRequestBuilder.timeout(memberVarReadTimeout);
    }
    if (memberVarInterceptor != null) {
      memberVarInterceptor.accept(localVarRequestBuilder);
    }
    return localVarRequestBuilder;
  }

}
